<html>

<head>
<title>Cubeia Poker</title>

<!-- Home Screen stuff.... -->
<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="images/poker_logo.png"/>
<link rel="apple-touch-icon-precomposed" href="images/poker_logo.png"/>




<link rel="stylesheet" type="text/css" media="screen" href="themes/ui.jqgrid.css"/>
<link rel="stylesheet" type="text/css" media="screen" href="themes/ui.multiselect.css"/>
<link rel="stylesheet" type="text/css" media="screen" href="themes/cubeia/jquery-ui-1.8.16.custom.css"/>


<style type="text/css">
	.logoSplash {
		opacity: 0;
		filter: Alpha(opacity = 0); /* IE8 and earlier */
	}

	#hidden {
		display: none;
	}

	html, body {
		margin: 0; /* Remove body margin/padding */
		padding: 0;
		overflow: hidden; /* Remove scroll bars on browser window */
		font-family: Verdana, Tahoma, Sans-Serif;
		font-size: 10pt;
	}

	#mask {
		position: absolute;
		left: 0;
		top: 0;
		z-index: 9000;
		background-color: #000;
		display: none;
	}

	#boxes .window {
		position: absolute;
		left: 0;
		top: 0;
		width: 1024px;
		height: 768px;
		display: none;
		z-index: 9999;
		padding: 0px;
	}

	#boxes #dialog {
		width: 375px;
		height: 203px;
		padding: 10px;
		background-color: #ffffff;
	}

	#boxes #dialog1 {
		width: 375px;
		height: 203px;
	}

	#dialog1 .d-header {
		background: url(images/login-header.png) no-repeat 0 0 transparent;
		width: 375px;
		height: 149px;
	}

	#dialog1 .d-header input {
		position: relative;
		top: 70px;
		left: 160px;
		border: 3px solid #cccccc;
		height: 22px;
		width: 160px;
		font-size: 15px;
		padding: 5px;
		margin-top: 4px;
	}

	#dialog1 .d-blank {
		float: left;
		background: url(images/login-blank.png) no-repeat 0 0 transparent;
		width: 267px;
		height: 53px;
	}

	#dialog1 .d-login {
		float: left;
		width: 108px;
		height: 53px;
	}

	#boxes #dialog2 {
		background: url(images/notice.png) no-repeat 0 0 transparent;
		width: 326px;
		height: 229px;
		padding: 50px 0 20px 25px;
	}

</style>

<meta charset="utf-8">

<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

<script src="js/jquery.js" type="text/javascript"></script>

<link rel="stylesheet" type="text/css" href="css/frames.css"/>
<link rel="stylesheet" type="text/css" href="css/fonts.css"/>
<link rel="stylesheet" type="text/css" href="css/buttons.css"/>
<link rel="stylesheet" type="text/css" href="css/elements_small.css"/>
<link rel="stylesheet" type="text/css" href="css/labels.css"/>
<link rel="stylesheet" type="text/css" href="css/plates.css"/>
<link rel="stylesheet" type="text/css" href="css/icons.css"/>
<link rel="stylesheet" type="text/css" href="css/anchors.css"/>
<link rel="stylesheet" type="text/css" href="css/CircularProgressBar.css"/>

<link rel="stylesheet" type="text/css" href="css/table.css"/>
<link rel="stylesheet" type="text/css" href="css/poker_buttons.css"/>
<link rel="stylesheet" type="text/css" href="css/slider.css" />

<script type="text/javascript" src="./js/ui/UiElementHandler.js"></script>
<script type="text/javascript" src="./js/ui/UiUtils.js"></script>
<script type="text/javascript" src="./js/ui/TextFeedback.js"></script>

<script type="text/javascript" src="./js/scene/View.js"></script>
<script type="text/javascript" src="./js/scene/RenderLoop.js"></script>

<script type="text/javascript" src="./js/scene/table/Table.js"></script>
<script type="text/javascript" src="./js/scene/table/SeatHandler.js"></script>
<script type="text/javascript" src="./js/scene/table/SpatialManager.js"></script>
<script type="text/javascript" src="./js/scene/table/WatchingPlayers.js"></script>

<script type="text/javascript" src="./js/scene/entity/EntityState.js"></script>
<script type="text/javascript" src="./js/scene/entity/EntityHandler.js"></script>


<script type="text/javascript" src="./js/scene/player/PlayerHandler.js"></script>
<script type="text/javascript" src="./js/scene/player/UserInput.js"></script>
<script type="text/javascript" src="./js/scene/player/PlayerActions.js"></script>

<script type="text/javascript" src="./js/scene/cards/PokerCards.js"></script>
<script type="text/javascript" src="./js/scene/cards/PokerDealer.js"></script>
<script type="text/javascript" src="./js/scene/cards/CommunityCards.js"></script>

<!--<script src="js/jquery-ui-1.8.16.custom.min.js" type="text/javascript"></script>-->
<script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="js/jquery-ui-1.8.21.custom.min.js"></script>
<!--<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css">-->
<script src="js/jquery.layout.js" type="text/javascript"></script>
<script src="js/i18n/grid.locale-en.js" type="text/javascript"></script>
<script type="text/javascript">
	$.jgrid.no_legacy_api = true;
	$.jgrid.useJSON = true;
</script>
<script src="js/jquery.jqGrid.min.js" type="text/javascript"></script>
<script src="js/jquery.ui.touch-punch.min.js"></script>

<script src="js/cubeia/firebase-js-api-1.8.0-CE-javascript.js" type="text/javascript"></script>
<script src="js/cubeia/firebase-protocol-1.8.0-CE-javascript.js" type="text/javascript"></script>

<script src="js/io/LobbyIO.js" type="text/javascript"></script>
<script src="js/poker-protocol-1.0-SNAPSHOT.js" type="text/javascript"></script>
<script src="js/PokerGameHandler.js" type="text/javascript"></script>
<script src="js/PokerProtocolHandler.js" type="text/javascript"></script>
<script src="js/io/TableIO.js" type="text/javascript"></script>
<script type="text/javascript" src="./js/ui/CircularProgressBar.js"></script>
<script type="text/javascript" src="./js/ui/BetSlider.js"></script>
<script type="text/javascript" src="./js/greensock/TweenMax.min.js"></script>
<script type="text/javascript" src="./js/greensock/TimelineMax.min.js"></script>

<script type="text/javascript" src="./js/scene/Animator.js"></script>


<style>
	body {
		-webkit-user-select: none;
		background: #000;
		color: #fff;
		padding: 0;
		margin: 0;
		overflow: hidden;
	}
</style>

<script>


	var connector;

	document.onkeydown = suppressBackspace;
	document.onkeypress = suppressBackspace;


	var lobbyWindow;
	var tableid;
	var pid;
	var screenname;
	var numberOfSeats;

    // create game message handlers
    var pokerGameHandler = new com.cubeia.games.poker.PokerGameHandler(this);
    var pokerProtocolHandler = new POKER_PROTOCOL.PokerProtocolHandler(pokerGameHandler);

    var animator;
    var animationTimeLine;
	var view;
	var uiElementHandler;
	var entityHandler;
	var playerHandler;
	var pokerCards;
	var pokerDealer;
	var userInput;
	var playerActions;
	var uiUtils;
	var usr, pwd;
	var autoLogin = false;
	var webSocketUrl = "localhost";
    //var webSocketUrl ="192.168.1.110";
	var webSocketPort = 9191;
	/*
	 * Provide a "seed" for setting ID's to the div hierarchy
	 * Children will use this "seed", add to it to create their own ID's somewhat recursively.
	 *
	 * The Div ID will be available from its entity when created, the entity then knows how to update itself visually
	 */

	var viewContainerDivId = "viewContainer";

	$(document).ready(function() {

		//lobbyWindow = window.opener;
		// lobbyWindow = parent
		tableid = getUrlParam("tableid");
		//pid = getUrlParam("pid");
		//screenname = getUrlParam("screenname");
		//numberOfSeats = parseInt(getUrlParam("capacity")) || 10;
		if (tableid) {
			usr = readCookie("usr");
			pwd = readCookie("pwd");
		}

		if (usr && pwd) {
			autoLogin = true;
		}

		connector = new FIREBASE.Connector(packetCallback, lobbyCallback, loginCallback, statusCallback);
		//$('#switcher').themeswitcher();
		if (autoLogin) {
			$('#splash').hide();
			connector.connect("FIREBASE.WebSocketAdapter", webSocketUrl, webSocketPort, "socket");
		} else {

			$('#logo').fadeIn(1000, function() {
				$('#logo').fadeOut(1000, function() {
					connector.connect("FIREBASE.WebSocketAdapter", webSocketUrl, webSocketPort, "socket");
				});
			});
		}
	});

	function showLogin() {

		//Get the screen height and width
		var maskHeight = $(document).height();
		var maskWidth = $(window).width();

		//Set height and width to mask to fill up the whole screen
		$('#mask').css({'width':maskWidth,'height':maskHeight});

		//transition effect
		$('#mask').fadeIn(1000);
		$('#mask').fadeTo("slow", 0.8);

		//Get the window height and width
		var winH = $(window).height();
		var winW = $(window).width();

		//Set the popup window to center
		$('#dialog1').css('top', winH / 2 - $('#dialog1').height() / 2);
		$('#dialog1').css('left', winW / 2 - $('#dialog1').width() / 2);

		//transition effect

		$('#dialog1').fadeIn(1000);

	}


	function showLobby() {

		var winH = $(window).height();
		var winW = $(window).width();

		//Set the popup window to center
		$('#lobby').css('top', 132);
		$('#lobby').css('left', 152);

		//$('#switcher').css('left', (winW/2-$('#lobby').width()/2)-100);
		//$('#switcher').css('top',  (winH/2-$('#lobby').height()/2)-300);
		//transition effect
		//$('#switcher').fadeIn(2000);

		$('#lobby').show();
        $('#boxes').show();
		createGrid();
		connector.lobbySubscribe(1, "/");
        if(view) {
            view.clear();
        }

		//fillData();
	}

	function callReload() {
		var href = location.href;

		if (!autoLogin) {
			createCookie("usr", usr);
			createCookie("pwd", pwd);
			href += "?tableid=" + tableid;
		}

		location.replace(href);
	}

	function createTable(table, capacity) {
		$('#boxes').fadeOut(500);
		$('#splash').remove();

		tableid = table;
		numberOfSeats = capacity;
		console.log("numberOfSeats [" + numberOfSeats + "]");
        animator = new Animator();
		view = new View(viewContainerDivId);
		uiElementHandler = new UiElementHandler();
		entityHandler = new EntityHandler();
		playerHandler = new PlayerHandler(pid);
		pokerCards = new PokerCards();
		pokerDealer = new PokerDealer();
		userInput = new UserInput();
		playerActions = new PlayerActions();
		uiUtils = new UiUtils();

		view.initTableView(numberOfSeats);
		userInput.setupUserInput();

		document.title = unescape(getUrlParam("title"));

		setTimeout(function() {
			console.log("Watching table: " + tableid);
			connector.watchTable(tableid);
		}, 500);
	}

</script>
</head>


<body id="body" oncontextmenu="return true" bgcolor="#000000">

<!-- Start of Login Dialog -->  <!-- End of Login Dialog -->


<div id="boxes">
	<!--div id="switcher" class="window"></div-->

	<div id="dialog1" class="window">
		<div class="d-header">
			<input name="user" id="user" type="text" value="username" onclick="this.value=''"/><br/>
			<input name="pwd" id="pwd" type="password" value="Password" onclick="this.value=''"/>
		</div>
		<div class="d-blank"></div>
		<div class="d-login"><input type="image" alt="Login" title="Login" src="images/login-button.png"
									onclick="doLogin()"/></div>
	</div>
	<div id="lobby" class="window">
		<table id="list4"></table>
	</div>

	<div id="mask"></div>


</div>


<div id="splash" class="splashDiv">
	<table width="100%" height="100%" valign="middle">
		<tr>
			<td>
				<center>
					<img id="logo" src="images/logo_large.png"/>
				</center>
			</td>
		</tr>
	</table>
</div>

<div id="eventLog">
</div>

</body>
</html>
 